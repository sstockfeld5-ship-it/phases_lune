<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Phases de la Lune (CM1/CM2)</title>
    <style>
        :root {
            --space-color: #0a0a2a;
            --sun-color: #ffcc00;
            --earth-color: #2e86c1;
            --moon-color: #dddddd;
            --shadow-color: #222;
            --orbit-speed: 20s; /* Dur√©e d'un cycle complet */
        }

        body {
            font-family: 'Comic Sans MS', Arial, sans-serif; /* Police adapt√©e aux enfants */
            background-color: var(--space-color);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--sun-color);
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }

        .main-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            max-width: 1000px;
            width: 100%;
        }

        /* --- Section Vue M√©canique (du dessus) --- */
        .mechanics-view {
            position: relative;
            width: 400px;
            height: 400px;
            border: 2px solid #ffffff33;
            border-radius: 50%;
            background: radial-gradient(circle, #1a1a4a 0%, #0a0a2a 100%);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .label {
            position: absolute;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
        }

        /* Le Soleil (Source de lumi√®re venant de la GAUCHE dans cet exemple) */
        .sun-source-indicator {
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--sun-color);
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .sun-source-indicator::after {
            content: "‚Üí‚Üí‚Üí Lumi√®re du Soleil";
            margin-left: 10px;
        }

        /* La Terre au centre */
        .earth {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, var(--earth-color), #1a5276);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            box-shadow: 0 0 15px var(--earth-color);
        }

        /* Conteneur rotatif pour l'orbite de la Lune */
        .moon-orbit-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            transform: translate(-50%, -50%);
            border: 1px dashed #ffffff55;
            border-radius: 50%;
            animation: orbitRotate var(--orbit-speed) linear infinite;
        }

        /* La Lune dans la vue m√©canique */
        .moon-mechanic {
            position: absolute;
            top: 0; /* Positionne la lune en haut du cercle d'orbite */
            left: 50%;
            width: 40px;
            height: 40px;
            margin-left: -20px; /* Centrage exact */
            margin-top: -20px;
            border-radius: 50%;
            /* L'astuce CSS pour l'√©clairage : un d√©grad√© qui reste fixe par rapport au soleil (√† gauche) */
            background: linear-gradient(90deg, var(--moon-color) 50%, var(--shadow-color) 50%);
            /* Contre-rotation pour garder la m√™me face vers la Terre */
            animation: counterRotate var(--orbit-speed) linear infinite;
            box-shadow: 0 0 5px #ffffff55;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Marqueur de la face visible (le drapeau rouge) */
        .face-marker {
            position: absolute;
            /* On place le marqueur sur le c√¥t√© GAUCHE de la lune (le c√¥t√© blanc initialement) */
            left: 5px; 
            width: 8px;
            height: 8px;
            background-color: red;
            border-radius: 50%;
            box-shadow: 0 0 5px red;
        }
        .marker-label {
             position: absolute;
             left: 15px;
             font-size: 0.7em;
             color: red;
             white-space: nowrap;
             /* Le texte doit aussi contre-tourner pour rester lisible */
             animation: orbitRotate var(--orbit-speed) linear infinite;
        }


        /* --- Section Vue depuis la Terre --- */
        .earth-view-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 300px;
        }

        .phase-display-box {
            width: 200px;
            height: 200px;
            background-color: var(--space-color);
            border: 4px solid var(--earth-color);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: inset 0 0 20px #000;
        }

        /* La repr√©sentation visuelle de la phase (g√©r√©e par JS) */
        #phase-visual {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--shadow-color); /* D√©part: Nouvelle lune (noir) */
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px #ffffff33;
        }
        
        /* Masques pour cr√©er les croissants et quartiers (pilot√©s par JS) */
        .mask-half {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background-color: var(--moon-color);
            transition: all 0.3s ease;
        }
        #mask-left { left: 0; transform-origin: right center;}
        #mask-right { right: 0; transform-origin: left center;}

        /* --- Textes et Explications --- */
        #phase-name {
            font-size: 1.8em;
            color: var(--sun-color);
            text-align: center;
            min-height: 1.8em;
            font-weight: bold;
        }

        .explanation-box {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            max-width: 800px;
            margin-top: 30px;
            border: 2px solid var(--sun-color);
        }

        .explanation-box h2 {
            color: var(--sun-color);
            margin-top: 0;
        }
        
        .important-note {
            color: red;
            font-weight: bold;
        }

        /* --- Animations CSS --- */
        /* Rotation de l'orbite compl√®te */
        @keyframes orbitRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Contre-rotation de la Lune sur elle-m√™me */
        /* C'est L'√âL√âMENT CL√â pour la rotation synchrone */
        @keyframes counterRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }
    </style>
</head>
<body>

    <h1>L'Animation des Phases de la Lune (CM1/CM2)</h1>

    <div class="main-container">
        <div style="text-align: center;">
            <h2>Vue du dessus (Dans l'espace)</h2>
            <div class="mechanics-view">
                <div class="sun-source-indicator"></div>
                <div class="label" style="top: 10px; left: 50%; transform: translateX(-50%);">Orbite de la Lune</div>
                
                <div class="earth">
                    <div class="label" style="top: 65px; left: 50%; transform: translateX(-50%);">Terre</div>
                </div>
                
                <div class="moon-orbit-container" id="orbit-container">
                    <div class="moon-mechanic">
                        <div class="face-marker"></div>
                        <div class="marker-label">Cette face regarde toujours la Terre !</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="earth-view-container">
            <h2>Vue depuis la Terre</h2>
            <div class="phase-display-box">
                <div id="phase-visual">
                     <div id="mask-left" class="mask-half"></div>
                    <div id="mask-right" class="mask-half"></div>
                </div>
            </div>
            <div>Phase actuelle :</div>
            <div id="phase-name">Nouvelle Lune</div>
        </div>
    </div>

    <div class="explanation-box">
        <h2>üí° Pourquoi la Lune change-t-elle de forme ?</h2>
        <p>La Lune ne produit pas sa propre lumi√®re, elle r√©fl√©chit la lumi√®re du Soleil. Comme une balle √©clair√©e par une lampe de poche, une moiti√© de la Lune est toujours √©clair√©e par le Soleil, et l'autre moiti√© est dans l'ombre.</p>
        <p>En tournant autour de la Terre, nous voyons diff√©rentes parties de sa face √©clair√©e. C'est ce qui cr√©e les <strong>phases</strong>.</p>
        
        <h2>ü§î Pourquoi voit-on toujours la m√™me face ?</h2>
        <p>Regarde le petit point <span class="important-note">rouge</span> sur la Lune dans la "Vue du dessus".</p>
        <p>La Lune tourne sur elle-m√™me exactement en m√™me temps qu'elle fait le tour de la Terre (environ 27 jours). C'est ce qu'on appelle la <strong>rotation synchrone</strong>. R√©sultat : elle nous pr√©sente toujours le m√™me c√¥t√© ! L'autre c√¥t√© est appel√© la "face cach√©e".</p>
    </div>

    <script>
        // Script pour synchroniser le nom et le visuel de la phase avec l'animation CSS
        const orbitContainer = document.getElementById('orbit-container');
        const phaseNameDisplay = document.getElementById('phase-name');
        const phaseVisual = document.getElementById('phase-visual');
        const maskLeft = document.getElementById('mask-left');
        const maskRight = document.getElementById('mask-right');

        // Fonction pour obtenir l'angle de rotation actuel de l'animation CSS
        function getRotationAngle(element) {
            const st = window.getComputedStyle(element, null);
            const tr = st.getPropertyValue("-webkit-transform") ||
                       st.getPropertyValue("-moz-transform") ||
                       st.getPropertyValue("-ms-transform") ||
                       st.getPropertyValue("-o-transform") ||
                       st.getPropertyValue("transform") ||
                       "FAIL";

            if (tr === "FAIL" || tr === "none") return 0;

            let values = tr.split('(')[1].split(')')[0].split(',');
            let a = values[0];
            let b = values[1];
            
            // Calcul de l'angle en degr√©s √† partir de la matrice de transformation
            let angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));
            
            // Normalisation de l'angle entre 0 et 360
            if (angle < 0) angle += 360;
            return angle;
        }

        // Fonction principale mise √† jour √† chaque image
        function updatePhaseInfo() {
            // L'angle 0 est en haut (Nouvelle Lune dans notre configuration o√π le soleil est √† gauche)
            // L'animation tourne dans le sens horaire.
            let angle = getRotationAngle(orbitContainer);
            
            let phaseName = "";
            let visualState = ""; // Pour contr√¥ler l'apparence de la lune vue de Terre

            // D√©termination de la phase en fonction de l'angle (approximation pour CM1/CM2)
            // Nous utilisons des plages d'angles pour d√©finir les 8 phases principales.
            if (angle >= 340 || angle < 20) {
                phaseName = "Nouvelle Lune";
                // Tout noir
                maskLeft.style.backgroundColor = "var(--shadow-color)";
                maskRight.style.backgroundColor = "var(--shadow-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                maskRight.style.transform = "rotateY(0deg)";
            } 
            else if (angle >= 20 && angle < 70) {
                phaseName = "Premier Croissant";
                // Croissant droit lumineux
                maskLeft.style.backgroundColor = "var(--shadow-color)";
                maskRight.style.backgroundColor = "var(--moon-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                // On "plie" le masque droit pour r√©v√©ler un croissant
                maskRight.style.transform = `rotateY(${180 - ((angle-20)/50 * 90)}deg)`; 
            } 
            else if (angle >= 70 && angle < 110) {
                phaseName = "Premier Quartier";
                 // Moiti√© droite lumineuse
                maskLeft.style.backgroundColor = "var(--shadow-color)";
                maskRight.style.backgroundColor = "var(--moon-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                maskRight.style.transform = "rotateY(0deg)";
            } 
            else if (angle >= 110 && angle < 160) {
                phaseName = "Lune Gibbeuse Croissante";
                 // Plus de la moiti√© droite lumineuse
                maskLeft.style.backgroundColor = "var(--moon-color)";
                maskRight.style.backgroundColor = "var(--moon-color)";
                maskRight.style.transform = "rotateY(0deg)";
                // On "d√©plie" le masque gauche (qui est couleur lune) pour couvrir l'ombre
                 maskLeft.style.transform = `rotateY(${(angle-110)/50 * 90}deg)`;
            } 
            else if (angle >= 160 && angle < 200) {
                phaseName = "Pleine Lune";
                // Tout lumineux
                maskLeft.style.backgroundColor = "var(--moon-color)";
                maskRight.style.backgroundColor = "var(--moon-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                maskRight.style.transform = "rotateY(0deg)";
            } 
            else if (angle >= 200 && angle < 250) {
                phaseName = "Lune Gibbeuse D√©croissante";
                // L'ombre arrive par la droite
                maskLeft.style.backgroundColor = "var(--moon-color)";
                maskRight.style.backgroundColor = "var(--moon-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                 // On commence √† plier le masque droit (couleur lune) pour r√©v√©ler le fond noir
                 maskRight.style.transform = `rotateY(${((angle-200)/50 * 90)}deg)`;
            } 
            else if (angle >= 250 && angle < 290) {
                phaseName = "Dernier Quartier";
                 // Moiti√© gauche lumineuse
                maskLeft.style.backgroundColor = "var(--moon-color)";
                maskRight.style.backgroundColor = "var(--shadow-color)";
                maskLeft.style.transform = "rotateY(0deg)";
                maskRight.style.transform = "rotateY(0deg)";
            } 
            else if (angle >= 290 && angle < 340) {
                phaseName = "Dernier Croissant";
                 // Croissant gauche lumineux
                maskLeft.style.backgroundColor = "var(--moon-color)";
                maskRight.style.backgroundColor = "var(--shadow-color)";
                maskRight.style.transform = "rotateY(0deg)";
                 // On replie le masque gauche pour ne laisser qu'un croissant
                 maskLeft.style.transform = `rotateY(${180 - ((angle-290)/50 * 90)}deg)`;
            }

            phaseNameDisplay.textContent = phaseName;
            
            // Boucle d'animation fluide
            requestAnimationFrame(updatePhaseInfo);
        }

        // D√©marrer la boucle de mise √† jour JS
        updatePhaseInfo();

    </script>
</body>
</html>
